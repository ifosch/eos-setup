---
# tasks file for docker

  - name: Add Docker apt repository keys
    apt_key: url="https://download.docker.com/linux/debian/gpg" id='0EBFCD88'
    register: docker_keys
    ignore_errors: yes
  - name: Get Docker apt repository keys
    shell: curl https://download.docker.com/linux/debian/gpg | apt-key add -
    become: yes
    when: docker_keys|failed

  - name: Add apt repositories (Debian)
    apt_repository: repo='{{ item }}'
    when: ansible_distribution == 'Debian'
    register: new_apt_repos_added
    with_items:
      - 'deb [arch=amd64] https://download.docker.com/linux/debian stretch stable'

  - name: Update apt caches (Forced)
    apt: update_cache=yes
    when:
      - new_apt_repos_added|changed

  - name: Install pip packages
    pip: name={{ item }}
    with_items:
      - docker-compose

  - name: Install apt packages
    apt: name={{ item }}
    with_items:
      - docker-ce
